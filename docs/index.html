<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>CensusHLA - a package to map US HLA Frequency data by region • CensusHLA</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="CensusHLA - a package to map US HLA Frequency data by region">
<meta name="description" content="Combines US HLA Frequencies with Census data for regional frequency predictions">
<meta property="og:description" content="Combines US HLA Frequencies with Census data for regional frequency predictions">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">CensusHLA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/Test.html">Test Roy 2025 Figures and tables</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Affini-T-Tx/CensusHLA/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="censushla">CensusHLA<a class="anchor" aria-label="anchor" href="#censushla"></a>
</h1></div>
<p><a href="https://doi.org/10.5281/zenodo.15148807" class="external-link"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.15148807.svg" alt="DOI"></a></p>
<p><a href="https://affini-t-tx.github.io/CensusHLA/">See Github pages (pkgdown) Documentation</a></p>
<p>CensusHLA is an R package designed to facilitate the analysis of HLA allele frequencies across the United States using census data and other external datasets. The package provides tools for importing, processing, and visualizing HLA frequency data, as well as integrating it with spatial and demographic information. It is particularly useful for researchers working in population genetics, immunogenetics, and public health.</p>
<figure><img src="reference/figures/a11_by_county.png" style="width:50.0%" alt="A11 by County"><figcaption aria-hidden="true">
A11 by County
</figcaption></figure><div class="section level2">
<h2 id="features">Features<a class="anchor" aria-label="anchor" href="#features"></a>
</h2>
<ul>
<li>Import and process HLA frequency data from external sources, specifically Gragert et al. (2013) as hosted by the NMDP.</li>
<li>Import and process spatial data from the US Census Bureau, including shapefiles and demographic data.</li>
<li>Calculate HLA allele frequencies at various geographic levels (e.g., state, county, catchment).</li>
<li>Generate visualizations of HLA allele distributions across geographic regions.</li>
<li>Integrate HLA data with US Census spatial and demographic data.</li>
</ul>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>To begin using the package, either make sure you have the system requirements, or install within the provided Docker container. After setting up the system requirements, clone the source code from github and begin to add the necessary source data as described below.</p>
</div>
<div class="section level2">
<h2 id="system-requirements">System Requirements<a class="anchor" aria-label="anchor" href="#system-requirements"></a>
</h2>
<p>The package was tested using the [rocker/verse:latest] Docker container with R 4.4.3, along with some additional system-level dependencies. Functions that plot frequencies using US maps and shapefiles may require the following R packages: <code>sf</code>, <code>h3jsr</code>, <code>rnaturalearth</code>, and <code>usmap</code>.</p>
</div>
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<div class="section level3">
<h3 id="docker-image">Docker Image<a class="anchor" aria-label="anchor" href="#docker-image"></a>
</h3>
<p>To simplify setup, a pre-configured <code>Dockerfile</code> is provided in <code>inst/extdata/</code>. Build the Docker container with:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">sudo</span> docker build <span class="at">-t</span> custom-rocker-verse .</span></code></pre></div>
<p>After building, you can start a Posit Workbench server using the <code>docker-compose.yml</code> file in the same directory:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">docker-compose</span> up</span></code></pre></div>
<p>Access the server at <code>http://localhost:8787</code> with username <code>rstudio</code> and password <code>password</code>.</p>
</div>
<div class="section level3">
<h3 id="census-api-key">Census API Key<a class="anchor" aria-label="anchor" href="#census-api-key"></a>
</h3>
<p>To access US Census data, you need an API key. Follow the instructions <a href="https://www.hrecht.com/censusapi/articles/getting-started.html#api-key-setup" class="external-link">here</a> to obtain your key. Add the key to your <code>~/.Renviron</code> file:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>CENSUS_KEY<span class="ot">=</span><span class="er">&lt;</span>YOUR CENSUS API CODE HERE<span class="sc">&gt;</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="gragert-2013-frequency-data">Gragert 2013 Frequency Data<a class="anchor" aria-label="anchor" href="#gragert-2013-frequency-data"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Download HLA-A, HLA-B, and HLA-C frequency data from <a href="https://frequency.nmdp.org/" class="external-link">this site</a>.</li>
<li>Place the downloaded <code>.xlsx</code> files in the <code>inst/extdata/</code> directory.</li>
</ol>
</div>
<div class="section level3">
<h3 id="option-1-automated-setup">Option 1: Automated Setup<a class="anchor" aria-label="anchor" href="#option-1-automated-setup"></a>
</h3>
<p>To automate the setup process, use the <code>inst/scripts/initiate_package_with_external_data.R</code> script. This script checks for required files and runs all necessary scripts in the correct order:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"inst/scripts/initiate_package_with_external_data.R"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="option-2-step-wise-data-preparation">Option 2: Step-wise Data Preparation<a class="anchor" aria-label="anchor" href="#option-2-step-wise-data-preparation"></a>
</h2>
<p>If the automated setup script above does not work, you can manually prepare the data files.</p>
<ol style="list-style-type: decimal">
<li>
<strong>Catchment Spatial Files</strong>: Run <code>data-raw/import_delNero2024_catchment.R</code>. 2 <strong>Census Spatial Files</strong>: Run <code>data-raw/import_census2020_tiger_shapefiles.R</code>. Note that downloading large shapefiles may take time (~30 minutes).</li>
<li>
<strong>Import Gragert 2013 Files</strong>: Run <code>data-raw/import_gragert2013_data.R</code>.</li>
<li>
<code>data-raw/nmdp_racegroups.R</code>: Creates a data object of NMDP race groups.</li>
<li>
<code>data-raw/valid_state_names.R</code>: Generates a vector of valid state names.</li>
<li>
<code>data-raw/us_pop_multirace_in_nmdp_codes.R</code>: Retrieves US-wide population estimates.</li>
<li>
<code>data-raw/nmdp_hla_frequencies_us_2020_census_adjusted.R</code>: Generates US-wide HLA frequency estimates.</li>
<li>
<code>data-raw/census_adjusted_nmdp_hla_frequencies_by_state.R</code>: Prepares state-level HLA frequency data.</li>
<li>
<code>data-raw/census_adjusted_nmdp_hla_frequencies_by_county.R</code>: Prepares county-level HLA frequency data. By default, only the top 20 most abundant HLAs are included.</li>
<li>
<code>data-raw/add_catchment_calculations_and_data.R</code>: Adds catchment-level calculations.
<ol style="list-style-type: decimal">
<li>This script may take significant time to run.</li>
</ol>
</li>
</ol>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<p>Provide examples of how to use the package for common tasks, such as visualizing HLA allele distributions or integrating external datasets.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Affini-T-Tx/CensusHLA" class="external-link">CensusHLA</a></span><span class="op">)</span></span>
<span><span class="va">state_frequencies</span> <span class="op">&lt;-</span> <span class="fu">CensusHLA</span><span class="fu">::</span><span class="va">census_adjusted_nmdp_hla_frequencies_by_state</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">allele</span> <span class="op">==</span> <span class="st">'A*11:01'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out_data</span> <span class="op">&lt;-</span> <span class="va">state_frequencies</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">region</span>, <span class="va">census_region</span>, <span class="va">fips</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>gf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">us_2020_nmdp_gf</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gg_state</span> <span class="op">&lt;-</span> <span class="fu">usmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/usmap/man/plot_usmap.html" class="external-link">plot_usmap</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">out_data</span>,</span>
<span>  regions <span class="op">=</span> <span class="st">"states"</span>,</span>
<span>  <span class="co">#exclude = c('Alaksa','Hawaii'),</span></span>
<span>  exclude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'AK'</span>, <span class="st">'HI'</span><span class="op">)</span>,</span>
<span>  values <span class="op">=</span> <span class="st">"gf"</span>,</span>
<span>  color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>  linewidth <span class="op">=</span> <span class="fl">0.1</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span>, direction <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gg_state</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="contributing">Contributing<a class="anchor" aria-label="anchor" href="#contributing"></a>
</h2>
<p>Contributions are welcome! Please submit issues or pull requests via GitHub.</p>
</div>
<div class="section level2">
<h2 id="license">License<a class="anchor" aria-label="anchor" href="#license"></a>
</h2>
<p>This project is licensed under the AGPLv2 License. See the <code>LICENSE.md</code> file for details.</p>
</div>
<div class="section level2">
<h2 id="acknowledgments">Acknowledgments<a class="anchor" aria-label="anchor" href="#acknowledgments"></a>
</h2>
<ul>
<li>Gragert et al. (2013) for HLA frequency data.</li>
<li>US Census Bureau for spatial and demographic data.</li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/Affini-T-Tx/CensusHLA/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/Affini-T-Tx/CensusHLA" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing CensusHLA</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Christian Roy <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-5953-5048" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christian Roy.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
